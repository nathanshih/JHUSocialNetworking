package com.jhu.socialnetworking.database;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.SQLException;

import javax.annotation.PostConstruct;
import javax.sql.DataSource;

public class InitializeDatabase {

	private DataSource dataSource;
	private static InitializeDatabase instance = null;
	private boolean isDatabaseInitialized = false;

	public static InitializeDatabase getInstance() {
		if (instance == null) {
			instance = new InitializeDatabase();
		}
		return instance;
	}

	protected InitializeDatabase() {
		// Exists only to defeat instantiation.
	}

	public void initializeDatabase(DataSource dataSource) {
		System.out.println("initializeDatabase()");

		if (!isDatabaseInitialized) {
			this.dataSource = dataSource;
			initializeStudentTable();
			isDatabaseInitialized = false;
		}
	}

	public void initializeStudentTable() {

		String sql = null;
		Connection conn = null;
		PreparedStatement ps = null;

		try {

			sql = "CREATE TABLE Student ("
					+ "student_id int GENERATED BY DEFAULT AS IDENTITY (START WITH 1, INCREMENT BY 1) NOT NULL, "
					+ "first_name varchar(10), " + "last_name varchar(10))"
					+ "PRIMARY KEY (student_id)";
			conn = dataSource.getConnection();
			ps = conn.prepareStatement(sql);
			ps.execute();

		} catch (SQLException e) {
			// throw new RuntimeException(e);
		}

	}

}
